//请求延迟的时间ms，如果时长小于0将会并发
var REQUEST_DELAY = 100;
var hostUrl = "http://www.banzhuer.org/";
function search(query){
    var baseUrl = hostUrl;
    var map = new HashMap();
    map.put("searchtype", "articlename")
    map.put("searchkey",URLEncoder.encode(query,"gbk"))
    var html = http.post(baseUrl+"modules/article/search.php",map);
    var parse = Jsoup.parse(html,baseUrl);
    try{
        var results = new ArrayList();
        var result = new SearchResult();
        result.source = source;
        result.bookTitle = parse.selectFirst("#info > h1").text();
        result.bookUrl = parse.selectFirst("[property=og:novel:read_url]").attr("content");
        result.bookAuthor = parse.selectFirst("[property=og:novel:author]").attr("content");
        //result.bookCover = parse.selectFirst("#fmimg > img").absUrl("src");
        results.add(result);
        return results;
    }catch(error){
        //Log.e(error,error);
        var bookList = parse.selectFirst("#content > table > tbody").select("tr");
        var results = new ArrayList();
        for (var i=1;i<bookList.size();i++){
            var bookElement = bookList.get(i);
            var result = new SearchResult();
            result.source = source;
            result.bookTitle = bookElement.selectFirst("a").text();
            result.bookUrl = bookElement.selectFirst("a").absUrl("href");
            result.bookAuthor = bookElement.child(2).text();
            results.add(result);
        }
        return results;

    }
}

/**
 * 书籍详情[JavaScript.source]
 */
function getDetails(http,url){
    var parse = Jsoup.parse(http.get(url),url);
    var book = new Book();
    book.source = source;
    //书籍信息
    book.url = url;
    book.title = parse.selectFirst("#info > h1").text();
    book.author = parse.selectFirst("[property=og:novel:author]").attr("content");
    book.intro = parse.selectFirst("#intro").html();
    //book.cover = bookInfo.select("#fmimg img").get(0).absUrl("src");
    var children = parse.selectFirst("#list dl").children();
    var chapterList = new ArrayList();
    for(i=children.size()-1; i>=0; i--){
        var chapterEl = children.get(i);
        if(chapterEl.tagName() == "dt"){
            break;
        }
        var chapter = new Chapter();
        chapter.title = chapterEl.child(0).text();
        chapter.url = chapterEl.child(0).absUrl("href");
        chapterList.add(0,chapter);
    }
    book.chapterList = chapterList;
    return book;
}

function getChapterContent(http,url){
    var parse = Jsoup.parse(http.get(url),url);
    var content = parse.getElementById("content").html();
    return content;
}